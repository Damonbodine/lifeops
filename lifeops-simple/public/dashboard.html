<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeOps - Your Personal Operating System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
        }

        .nav-item span {
            margin-left: 10px;
        }

        .main-content {
            margin-left: 280px;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.95);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .feature-card h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Pomodoro Timer Styles */
        .timer-display {
            text-align: center;
            margin: 20px 0;
        }

        .timer-time {
            font-size: 4rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .timer-status {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .intent-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        /* Task Queue Styles */
        .task-section {
            margin-bottom: 25px;
        }

        .task-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .task-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .task-input input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
        }

        .task-input button {
            padding: 10px 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: between;
            padding: 12px;
            background: #f8f9fa;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        .task-item.big {
            border-left-color: #e74c3c;
        }

        .task-item.medium {
            border-left-color: #f39c12;
        }

        .task-item.small {
            border-left-color: #27ae60;
        }

        .task-text {
            flex: 1;
        }

        .task-delete {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: #3498db;
            transition: width 0.3s;
        }

        .section-title {
            color: white;
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="logo">üßê LifeOps</div>
        <div class="nav-item active" onclick="showSection('dashboard')">
            <span>üìä</span>
            <span>Dashboard</span>
        </div>
        <div class="nav-item" onclick="showSection('pomodoro')">
            <span>üçÖ</span>
            <span>Smart Pomodoro</span>
        </div>
        <div class="nav-item" onclick="showSection('tasks')">
            <span>üìã</span>
            <span>1-3-5 Tasks</span>
        </div>
        <div class="nav-item" onclick="showSection('emails')">
            <span>üìß</span>
            <span>Email Analysis</span>
        </div>
        <div class="nav-item" onclick="showSection('ai-score')">
            <span>ü§ñ</span>
            <span>AI Daily Score</span>
        </div>
        <div class="nav-item" onclick="showSection('check-ins')">
            <span>üíå</span>
            <span>Check In</span>
        </div>
    </div>

    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section">
            <div class="header">
                <h1>Welcome to LifeOps</h1>
                <p>Your AI-powered productivity companion</p>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="focusTime">0</div>
                    <div class="stat-label">Minutes Focused Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completedSessions">0</div>
                    <div class="stat-label">Pomodoro Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="tasksCompleted">0</div>
                    <div class="stat-label">Tasks Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="productivityScore">85</div>
                    <div class="stat-label">AI Productivity Score</div>
                </div>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üî• Today's Focus</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%"></div>
                    </div>
                    <p>65% of daily focus goal achieved</p>
                </div>
                <div class="feature-card">
                    <h3>‚ö° Quick Actions</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showSection('pomodoro')">Start Focus Session</button>
                        <button class="btn btn-success" onclick="showSection('tasks')">Add Task</button>
                        <button class="btn" onclick="showSection('emails')" style="background: #9b59b6; color: white;">Check Emails</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Section -->
        <div id="pomodoro" class="section" style="display: none;">
            <h2 class="section-title">üçÖ Smart Pomodoro Timer</h2>
            
            <div class="feature-card">
                <div class="timer-display">
                    <div class="timer-time" id="timerDisplay">25:00</div>
                    <div class="timer-status" id="timerStatus">Ready to focus</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <input type="text" class="intent-input" id="sessionIntent" placeholder="What's your focus intention for this session?">
                </div>

                <div class="timer-controls">
                    <button class="btn btn-success" id="startBtn" onclick="startTimer()">Start Session</button>
                    <button class="btn btn-danger" id="pauseBtn" onclick="pauseTimer()" style="display: none;">Pause</button>
                    <button class="btn" id="resetBtn" onclick="resetTimer()">Reset</button>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <p>Session Duration: 
                        <select id="sessionDuration" onchange="updateDuration()">
                            <option value="25">25 minutes</option>
                            <option value="45">45 minutes</option>
                            <option value="90">90 minutes</option>
                        </select>
                    </p>
                </div>
            </div>

            <div class="feature-card" style="margin-top: 20px;">
                <h3>üìà Recent Sessions</h3>
                <div id="sessionHistory">
                    <div class="task-item">
                        <span>üî• Email Processing - 25 min</span>
                        <span style="margin-left: auto; color: #27ae60;">Completed</span>
                    </div>
                    <div class="task-item">
                        <span>üíª Code Review - 45 min</span>
                        <span style="margin-left: auto; color: #27ae60;">Completed</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="tasks" class="section" style="display: none;">
            <h2 class="section-title">üìã 1-3-5 Task Queue</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="task-section">
                        <h4>üî• 1 Big Task</h4>
                        <div class="task-input">
                            <input type="text" id="bigTaskInput" placeholder="Your most important task today">
                            <button onclick="addTask('big')">Add</button>
                        </div>
                        <ul class="task-list" id="bigTasks"></ul>
                    </div>

                    <div class="task-section">
                        <h4>‚ö° 3 Medium Tasks</h4>
                        <div class="task-input">
                            <input type="text" id="mediumTaskInput" placeholder="Important but manageable task">
                            <button onclick="addTask('medium')">Add</button>
                        </div>
                        <ul class="task-list" id="mediumTasks"></ul>
                    </div>

                    <div class="task-section">
                        <h4>‚úÖ 5 Small Tasks</h4>
                        <div class="task-input">
                            <input type="text" id="smallTaskInput" placeholder="Quick win or small task">
                            <button onclick="addTask('small')">Add</button>
                        </div>
                        <ul class="task-list" id="smallTasks"></ul>
                    </div>
                </div>

                <div class="feature-card">
                    <h3>üéØ Today's Progress</h3>
                    <div style="margin: 20px 0;">
                        <p>Big Tasks: <span id="bigProgress">0/1</span></p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="bigProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin: 20px 0;">
                        <p>Medium Tasks: <span id="mediumProgress">0/3</span></p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="mediumProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin: 20px 0;">
                        <p>Small Tasks: <span id="smallProgress">0/5</span></p>
                        <div class="progress-bar">
                            <div class="progress-fill" id="smallProgressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; text-align: center;">
                        <div class="stat-number" id="overallProgress">0%</div>
                        <div class="stat-label">Overall Completion</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emails Section -->
        <div id="emails" class="section" style="display: none;">
            <iframe src="/" width="100%" height="600px" style="border: none; border-radius: 12px;"></iframe>
        </div>

        <!-- AI Score Section -->
        <div id="ai-score" class="section" style="display: none;">
            <h2 class="section-title">ü§ñ AI Daily Score & Insights</h2>
            
            <div class="feature-grid">
                <div class="feature-card" style="text-align: center;">
                    <h3>Today's Productivity Score</h3>
                    <div class="stat-number" style="font-size: 4rem; color: #27ae60;">85</div>
                    <p style="color: #7f8c8d;">Based on focus time, task completion, and email management</p>
                </div>

                <div class="feature-card">
                    <h3>üéØ AI Insights</h3>
                    <div style="line-height: 1.6;">
                        <p><strong>‚úÖ Strengths Today:</strong></p>
                        <ul style="margin: 10px 0 20px 20px;">
                            <li>Excellent focus session completion rate</li>
                            <li>Proactive email management</li>
                            <li>Good task prioritization</li>
                        </ul>
                        
                        <p><strong>üí° Improvement Opportunities:</strong></p>
                        <ul style="margin: 10px 0 20px 20px;">
                            <li>Consider longer focus blocks for deep work</li>
                            <li>Schedule email processing at specific times</li>
                            <li>Add more small wins to build momentum</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="feature-card" style="margin-top: 20px;">
                <h3>üìä This Week's Trends</h3>
                <div style="text-align: center; padding: 20px;">
                    <p style="color: #7f8c8d;">Weekly analytics will appear here</p>
                    <p style="color: #7f8c8d;">Track your productivity patterns and improvements over time</p>
                </div>
            </div>
        </div>

        <!-- Check-ins Section -->
        <div id="check-ins" class="section" style="display: none;">
            <h2 class="section-title">üíå Relationship Check-ins</h2>
            
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>üéØ This Week's Goal</h3>
                    <p id="weeklyGoal" style="font-size: 1.1rem; line-height: 1.6; color: #2c3e50;">Loading your relationship insights...</p>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="loadCheckIns()">üîÑ Refresh Check-ins</button>
                    </div>
                </div>

                <div class="feature-card">
                    <h3>üë• Priority Check-ins</h3>
                    <div id="priorityContacts">
                        <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                            <p>Analyzing your message history...</p>
                            <p>Finding friends you should reconnect with</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="feature-card" style="margin-top: 20px;">
                <h3>üì± Quick Actions</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn" style="background: #27ae60; color: white;" onclick="openMessages()">
                        üì± Open Messages App
                    </button>
                    <button class="btn" style="background: #3498db; color: white;" onclick="scheduleReminder()">
                        ‚è∞ Set Weekly Reminder
                    </button>
                    <button class="btn" style="background: #9b59b6; color: white;" onclick="exportContacts()">
                        üìã Export Contact List
                    </button>
                </div>

                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">üí° Pro Tips:</h4>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li>Check in with close friends every 2-3 weeks</li>
                        <li>Send genuine, personal messages rather than generic "how are you?"</li>
                        <li>Reference shared memories or ask about specific things</li>
                        <li>Set a weekly goal to reach out to 2-3 people</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentSection = 'dashboard';
        let timerInterval = null;
        let timeRemaining = 25 * 60; // 25 minutes in seconds
        let isRunning = false;
        let completedSessions = 0;
        let totalFocusTime = 0;

        // Task storage
        let tasks = {
            big: [],
            medium: [],
            small: []
        };

        // Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
            
            // Show selected section
            document.getElementById(section).style.display = 'block';
            
            // Update active nav
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            currentSection = section;
            
            // Auto-load data for specific sections
            if (section === 'check-ins') {
                loadCheckIns();
            }
        }

        // Pomodoro Timer Functions
        function startTimer() {
            const intent = document.getElementById('sessionIntent').value;
            if (!intent.trim()) {
                alert('Please enter your focus intention first!');
                return;
            }

            isRunning = true;
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            document.getElementById('timerStatus').textContent = `Focusing on: ${intent}`;

            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();

                if (timeRemaining <= 0) {
                    completeSession();
                }
            }, 1000);
        }

        function pauseTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('timerStatus').textContent = 'Paused';
        }

        function resetTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            const duration = parseInt(document.getElementById('sessionDuration').value);
            timeRemaining = duration * 60;
            updateTimerDisplay();
            document.getElementById('startBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('timerStatus').textContent = 'Ready to focus';
            document.getElementById('sessionIntent').value = '';
        }

        function completeSession() {
            clearInterval(timerInterval);
            isRunning = false;
            
            // Update stats
            completedSessions++;
            const sessionMinutes = parseInt(document.getElementById('sessionDuration').value);
            totalFocusTime += sessionMinutes;
            
            // Update display
            document.getElementById('completedSessions').textContent = completedSessions;
            document.getElementById('focusTime').textContent = totalFocusTime;
            
            alert('üéâ Focus session completed! Great work!');
            resetTimer();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateDuration() {
            if (!isRunning) {
                const duration = parseInt(document.getElementById('sessionDuration').value);
                timeRemaining = duration * 60;
                updateTimerDisplay();
            }
        }

        // Task Management Functions
        function addTask(type) {
            const input = document.getElementById(`${type}TaskInput`);
            const text = input.value.trim();
            
            if (!text) return;

            // Check limits
            const limits = { big: 1, medium: 3, small: 5 };
            if (tasks[type].length >= limits[type]) {
                alert(`You can only have ${limits[type]} ${type} task(s)`);
                return;
            }

            const task = {
                id: Date.now(),
                text: text,
                completed: false
            };

            tasks[type].push(task);
            input.value = '';
            renderTasks();
            updateProgress();
        }

        function deleteTask(type, id) {
            tasks[type] = tasks[type].filter(task => task.id !== id);
            renderTasks();
            updateProgress();
        }

        function toggleTask(type, id) {
            const task = tasks[type].find(task => task.id === id);
            if (task) {
                task.completed = !task.completed;
                renderTasks();
                updateProgress();
                updateCompletedTasks();
            }
        }

        function renderTasks() {
            ['big', 'medium', 'small'].forEach(type => {
                const container = document.getElementById(`${type}Tasks`);
                container.innerHTML = '';

                tasks[type].forEach(task => {
                    const li = document.createElement('li');
                    li.className = `task-item ${type}`;
                    li.innerHTML = `
                        <input type="checkbox" ${task.completed ? 'checked' : ''} 
                               onchange="toggleTask('${type}', ${task.id})" style="margin-right: 10px;">
                        <span class="task-text" style="${task.completed ? 'text-decoration: line-through; opacity: 0.6;' : ''}">${task.text}</span>
                        <button class="task-delete" onclick="deleteTask('${type}', ${task.id})">√ó</button>
                    `;
                    container.appendChild(li);
                });
            });
        }

        function updateProgress() {
            const limits = { big: 1, medium: 3, small: 5 };
            let totalCompleted = 0;
            let totalTasks = 0;

            ['big', 'medium', 'small'].forEach(type => {
                const completed = tasks[type].filter(task => task.completed).length;
                const total = tasks[type].length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;

                document.getElementById(`${type}Progress`).textContent = `${completed}/${total}`;
                document.getElementById(`${type}ProgressBar`).style.width = `${percentage}%`;

                totalCompleted += completed;
                totalTasks += total;
            });

            const overallPercentage = totalTasks > 0 ? Math.round((totalCompleted / totalTasks) * 100) : 0;
            document.getElementById('overallProgress').textContent = `${overallPercentage}%`;
        }

        function updateCompletedTasks() {
            const completed = Object.values(tasks).flat().filter(task => task.completed).length;
            document.getElementById('tasksCompleted').textContent = completed;
        }

        // Check-in Functions
        async function loadCheckIns() {
            try {
                document.getElementById('weeklyGoal').textContent = 'Loading...';
                document.getElementById('priorityContacts').innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;"><p>Analyzing your relationships...</p></div>';
                
                const response = await fetch('/api/check-ins');
                const data = await response.json();
                
                // Update weekly goal
                document.getElementById('weeklyGoal').textContent = data.weeklyGoal;
                
                // Update priority contacts
                const contactsContainer = document.getElementById('priorityContacts');
                if (data.priorityContacts && data.priorityContacts.length > 0) {
                    contactsContainer.innerHTML = data.priorityContacts.map(contact => `
                        <div class="task-item" style="margin: 10px 0; padding: 15px;">
                            <div style="flex: 1;">
                                <div style="font-weight: bold; margin-bottom: 5px;">üë§ ${contact.name}</div>
                                <div style="color: #e74c3c; font-size: 0.9rem; margin-bottom: 5px;">
                                    üìÖ ${contact.daysSince} days since last contact
                                </div>
                                <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 10px;">
                                    ${contact.reason}
                                </div>
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px; font-style: italic;">
                                    üí¨ "${contact.suggestedMessage}"
                                </div>
                            </div>
                            <button class="btn btn-success" onclick="sendMessage('${contact.name}')" style="margin-left: 15px; white-space: nowrap;">
                                üíå Message
                            </button>
                        </div>
                    `).join('');
                } else {
                    contactsContainer.innerHTML = `
                        <div style="text-align: center; color: #27ae60; padding: 20px;">
                            <p>üéâ You're doing great at staying connected!</p>
                            <p>No urgent check-ins needed right now.</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading check-ins:', error);
                document.getElementById('priorityContacts').innerHTML = `
                    <div style="text-align: center; color: #e74c3c; padding: 20px;">
                        <p>‚ùå Error loading check-ins</p>
                        <p>Make sure LifeOps has Full Disk Access permission</p>
                    </div>
                `;
            }
        }

        async function sendMessage(contactName) {
            try {
                const response = await fetch('/api/open-messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ contact: contactName })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show a brief success message
                    const button = event.target;
                    const originalText = button.textContent;
                    button.textContent = '‚úì Opened!';
                    button.style.background = '#27ae60';
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.style.background = '#27ae60';
                    }, 2000);
                } else {
                    alert('Could not open Messages app. Please try manually.');
                }
            } catch (error) {
                console.error('Error opening Messages:', error);
                alert('Error opening Messages app. Please try manually.');
            }
        }

        async function openMessages() {
            try {
                const response = await fetch('/api/open-messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ contact: '' }) // Empty contact = just open Messages
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    alert('Could not open Messages app');
                }
            } catch (error) {
                console.error('Error opening Messages:', error);
                alert('Error opening Messages app');
            }
        }

        function scheduleReminder() {
            // Set a weekly reminder using macOS notifications
            alert('‚è∞ Weekly relationship check-in reminder set!\n\nYou\'ll get notified every Monday at 9 AM to review your relationships.');
            
            // In a real implementation, you'd use:
            // - macOS Calendar app to create recurring event
            // - LaunchAgent for system-level notifications
            // - or Electron's notification API
        }

        function exportContacts() {
            // Export priority contacts as a simple list
            loadCheckIns().then(() => {
                const contacts = document.querySelectorAll('#priorityContacts .task-item');
                let exportText = "LifeOps Relationship Check-in List\n";
                exportText += "Generated: " + new Date().toLocaleDateString() + "\n\n";
                
                contacts.forEach((contact, index) => {
                    const name = contact.querySelector('div:first-child div:first-child').textContent.replace('üë§ ', '');
                    const days = contact.querySelector('div:first-child div:nth-child(2)').textContent;
                    exportText += `${index + 1}. ${name} - ${days}\n`;
                });
                
                // Create downloadable file
                const blob = new Blob([exportText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'lifeops-checkins.txt';
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateTimerDisplay();
            renderTasks();
            updateProgress();
            
            // Auto-load check-ins when section is first visited
            if (currentSection === 'check-ins') {
                loadCheckIns();
            }
        });
    </script>
</body>
</html>